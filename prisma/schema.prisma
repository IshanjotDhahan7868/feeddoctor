generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Store {
  id             String          @id @default(cuid())
  name           String
  url            String          @unique
  contactEmail   String?
  contactPageUrl String?
  instagramUrl   String?
  isShopify      Boolean         @default(false)
  createdAt      DateTime        @default(now())
  issues         Issue[]
  outreachDraft  OutreachDraft?
  pipeline       PipelineStatus?
  products       Product[]
}

model Product {
  id          String  @id @default(cuid())
  storeId     String
  url         String
  title       String?
  price       String?
  brand       String?
  gtin        String?
  mpn         String?
  imageWidth  Int?
  imageHeight Int?
  Issue       Issue[]
  store       Store   @relation(fields: [storeId], references: [id])
}

model Issue {
  id          String   @id @default(cuid())
  storeId     String
  productId   String?
  severity    Severity
  description String
  createdAt   DateTime @default(now())
  product     Product? @relation(fields: [productId], references: [id])
  store       Store    @relation(fields: [storeId], references: [id])
}

model OutreachDraft {
  id        String   @id @default(cuid())
  storeId   String   @unique
  subject   String
  firstLine String
  emailBody String
  dmBody    String
  createdAt DateTime @default(now())
  store     Store    @relation(fields: [storeId], references: [id])
}

model PipelineStatus {
  id        String   @id @default(cuid())
  storeId   String   @unique
  stage     Stage    @default(NEW)
  updatedAt DateTime @updatedAt
  store     Store    @relation(fields: [storeId], references: [id])
}

model Order {
  id              String   @id @default(cuid())
  email           String
  stripeSessionId String   @unique
  priceId         String?
  amount          Int?
  status          String   @default("pending")
  deliverableUrl  String?
  createdAt       DateTime @default(now())
  stripeId        String   @unique
}

model WebhookEvent {
  id        String   @id @default(cuid())
  type      String
  raw       Json
  createdAt DateTime @default(now())
}

model ScanJob {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  sourceType String
  input      String
  email      String?
  status     String   @default("pending")
  outputUrl  String?
}

model OutreachLead {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  storeUrl  String
  stage     String   @default("new")
  notes     String?
}

enum Severity {
  LOW
  MEDIUM
  HIGH
}

enum Stage {
  NEW
  CONTACTED
  INTERESTED
  CLOSED
}
